<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain-Fry | High Speed Quiz</title>
    <link rel="icon" type="image/png" href="assets/images/logo.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --comic-yellow: #ffde03;
            --comic-red: #ff0000;
            --comic-blue: #0336ff;
            --comic-green: #00d100;
            --dark-bg: #1a1a1a;
        }
        body {
            background-color: var(--comic-blue);
            background-image: radial-gradient(#00000033 2px, transparent 2px);
            background-size: 20px 20px;
            color: white;
            font-family: 'Comic Neue', cursive;
            overflow: hidden;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
        }
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--comic-red);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: transform 0.8s cubic-bezier(0.87, 0, 0.13, 1);
            cursor: pointer;
        }
        #splash-screen.hidden {
            transform: translateY(-100%);
        }
        .splash-title {
            font-family: 'Bungee', cursive;
            font-size: 15vw;
            color: white;
            text-shadow: 10px 10px 0px black;
            animation: splashPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .tap-hint {
            font-family: 'Bungee', cursive;
            color: white;
            font-size: 1.5rem;
            margin-top: 2rem;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        @keyframes splashPop {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        /* === LOGO KI STYLING UPDATE KI GAYI HAI === */
        #game-logo-overlay {
            position: fixed;
            top: 25px;
            left: 25px;
            width: 80px;
            z-index: 1001;
            transform: rotate(-15deg);
            animation: logoWobble 3s ease-in-out infinite;
            pointer-events: none;
            /* Stroke aur shadow dono add kar diye gaye hain */
            filter: drop-shadow(6px 6px 0px black) drop-shadow(-2px -2px 0 black) drop-shadow(2px -2px 0 black) drop-shadow(-2px 2px 0 black) drop-shadow(2px 2px 0 black);
        }
        #game-logo-overlay.hidden {
            display: none;
        }
        @keyframes logoWobble {
            0%, 100% {
                transform: rotate(-15deg) translateY(0px) scale(1);
            }
            50% {
                transform: rotate(-10deg) translateY(-5px) scale(1.05);
            }
        }
        /* ============================================== */
        
        .icon-button {
            position: fixed;
            top: 10px;
            z-index: 1000;
            background: white;
            border: 3px solid black;
            padding: 5px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .icon-button.hidden {
            display: none !important;
        }
        .home-button {
            right: 10px;
        }
        .settings-button {
            right: 60px; /* Position adjusted */
        }
        /* Naya Information Button */
        .info-button {
            right: 110px; /* Position adjusted */
        }
        
        .share-button {
            background: #25d366;
            color: white;
            border: 2px solid black;
            padding: 4px 8px;
            font-size: 0.8rem;
            font-family: 'Bungee', cursive;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .highscore-bar {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 3px solid black;
            padding: 5px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            font-family: 'Bungee', cursive;
            font-size: 0.8rem;
        }
        .highscore-bar.hidden {
            display: none;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            width: 90%;
            max-width: 400px;
            background: var(--comic-yellow);
            border: 6px solid black;
            box-shadow: 10px 10px 0px black;
            padding: 2rem;
            color: black;
        }
        .modal.active {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
        }
        .modal-overlay.active {
            display: block;
        }

        /* Naye Info Modal ke liye specific styles */
        #info-modal h3 {
            font-family: 'Bungee', cursive;
            background: var(--comic-red);
            color: white;
            padding: 0.2rem 0.5rem;
            border: 2px solid black;
            align-self: flex-start;
            margin-bottom: 0.5rem;
            transform: rotate(-2deg);
        }
        #info-modal p, #info-modal a {
            font-size: 0.9rem;
            line-height: 1.4;
        }
        #info-modal a {
            color: var(--comic-blue);
            text-decoration: underline;
            font-weight: bold;
        }

        .comic-panel {
            background: var(--comic-yellow);
            border: 6px solid black;
            box-shadow: 10px 10px 0px black;
            color: black;
            border-radius: 0;
            position: relative;
            transform: rotate(-1deg);
        }
        .comic-title {
            font-family: 'Bungee', cursive;
            background: var(--comic-red);
            color: white;
            padding: 0.5rem 1rem;
            border: 4px solid black;
            box-shadow: 5px 5px 0px black;
            transform: rotate(2deg);
        }
        .funny-button-pink {
            background: #ff00ff;
            border: 4px solid black;
            color: white;
            box-shadow: 5px 5px 0px black;
            transition: all 0.1s;
            font-family: 'Bungee', cursive;
        }
        .funny-button-pink:active {
            transform: translate(3px, 3px);
            box-shadow: 2px 2px 0px black;
        }
        .funny-button-cyan {
            background: #00ffff;
            border: 4px solid black;
            color: black;
            box-shadow: 5px 5px 0px black;
            transition: all 0.1s;
            font-family: 'Bungee', cursive;
        }
        .funny-button-cyan:active {
            transform: translate(3px, 3px);
            box-shadow: 2px 2px 0px black;
        }
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            width: 90%;
            max-width: 500px;
            padding: 2.5rem;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .screen.active {
            display: flex;
        }
        @keyframes popIn {
            0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
            100% { transform: scale(1) rotate(-1deg); opacity: 1; }
        }
        @keyframes wobble {
            0%, 100% { transform: rotate(-1deg) scale(1); }
            25% { transform: rotate(1deg) scale(1.05); }
            75% { transform: rotate(-2deg) scale(0.95); }
        }
        .wobble-active {
            animation: wobble 0.3s ease-in-out infinite;
        }
        #timer-bar-container {
            width: 100%;
            height: 20px;
            background: white;
            border: 3px solid black;
            border-radius: 0;
            overflow: hidden;
        }
        #timer-bar {
            width: 100%;
            height: 100%;
            background: var(--comic-red);
            transition: width 0.1s linear;
        }
        .speech-bubble {
            position: relative;
            background: white;
            border: 4px solid black;
            padding: 1rem;
            margin-bottom: 20px;
        }
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50px;
            border-width: 20px 20px 0;
            border-style: solid;
            border-color: white transparent;
            display: block;
            width: 0;
        }
        .speech-bubble:before {
            content: '';
            position: absolute;
            bottom: -26px;
            left: 48px;
            border-width: 22px 22px 0;
            border-style: solid;
            border-color: black transparent;
            display: block;
            width: 0;
        }
        #player-name-input {
            caret-color: var(--comic-red);
        }
        #player-name-input:focus {
            animation: cursorBlink 1s infinite;
        }
        @keyframes cursorBlink {
            0%, 100% { border-color: black; }
            50% { border-color: var(--comic-red); }
        }
        .delayed-entry {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-out;
            pointer-events: none;
        }
        .delayed-entry.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        /* === MOBILE RESPONSIVE BUTTONS === */
        @media screen and (max-width: 480px) {
            #screen-game .funny-button-cyan, #screen-game .funny-button-pink {
                padding-top: 1rem;
                padding-bottom: 1rem;
                font-size: 1.25rem;
            }
            #screen-over button {
                padding: 0.8rem;
                font-size: 1rem;
            }
            #screen-over .flex {
                flex-direction: column;
            }
            #question-text {
                font-size: 1.75rem;
                min-height: 100px;
            }
            .comic-title {
                font-size: 2.5rem;
            }
        }
        /* ================================ */
    </style>
</head>
<body>

    <img src="assets/images/logo.png" id="game-logo-overlay" class="hidden">

    <!-- Splash Screen -->
    <div id="splash-screen" onclick="skipSplash()">
        <div class="splash-title">BRAIN-FRY</div>
        <div class="tap-hint">TAP HERE</div>
    </div>

    <!-- Buttons -->
    <button id="global-home-button" onclick="showMenu()" class="icon-button home-button funny-button-pink hidden">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    </button>
    <button id="global-settings-button" onclick="toggleSettings(true)" class="icon-button settings-button funny-button-cyan hidden">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
    </button>
    <!-- Naya Information Button -->
    <button id="global-info-button" onclick="toggleInfo(true)" class="icon-button info-button funny-button-pink hidden" style="background: var(--comic-yellow); color: black;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
    </button>


    <div id="modal-overlay" class="modal-overlay" onclick="closeAllModals()"></div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <h2 class="text-2xl comic-title w-full text-center">SETTINGS</h2>
        <div class="flex flex-col gap-4 w-full">
            <button onclick="toggleMusic()" id="music-toggle-btn" class="funny-button-cyan py-3 w-full">MUSIC: ON</button>
            <button onclick="toggleSoundFX()" id="soundfx-toggle-btn" class="funny-button-cyan py-3 w-full">SOUNDS: ON</button>
            <button onclick="resetHighScore()" class="funny-button-pink py-3 w-full">RESET HIGH SCORE</button>
            <button onclick="resetName()" class="funny-button-pink py-3 w-full" style="background: #ffde03; color: black;">CHANGE NAME</button>
            <button onclick="toggleSettings(false)" class="funny-button-pink py-3 w-full" style="background: black;">CLOSE</button>
        </div>
    </div>
    
    <!-- Naya Information Modal -->
    <div id="info-modal" class="modal">
        <h2 class="text-2xl comic-title w-full text-center">INFORMATION</h2>
        <div class="flex flex-col gap-4 w-full text-black">
            <div>
                <h3>Game ko kaisa khelta hai?</h3>
                <p>Screen par diye gaye sawal ko parhein aur tezi se 'SAHI' ya 'GALAT' select karein. Har sahi jawab par score barhega aur level up hoga!</p>
            </div>
            <div>
                <h3>Game ko banane ka maqsad?</h3>
                <p>Yeh game dimagh ko tez karne aur masti karne ke liye banayi gayi hai. Apne doston ko challenge karein aur dekhein kon zyada score banata hai!</p>
            </div>
            <div>
                <h3>Game ko kisne banaya hai?</h3>
                <p>Is game ko <b>Elia Haider</b> ne Pakistan se banaya hai.</p>
            </div>
            <div>
                <h3>Contact Information</h3>
                <p>Instagram: <a href="https://www.instagram.com/d_testing_" target="_blank">@d_testing_</a></p>
                <p>Gmail: <a href="mailto:haiderhashmi11220@gmail.com">haiderhashmi11220@gmail.com</a></p>
            </div>
            <button onclick="toggleInfo(false)" class="funny-button-pink py-3 w-full" style="background: black;">CLOSE</button>
        </div>
    </div>

    <div id="global-highscore-bar" class="highscore-bar hidden">
        <span>HIGH SCORE: <span id="bar-highscore-val">0</span></span>
        <button onclick="shareScore()" class="share-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            SHARE
        </button>
    </div>

    <!-- Screen Name -->
    <div id="screen-name" class="screen active comic-panel">
        <h1 class="text-5xl comic-title">BRAIN-FRY</h1>
        <div id="name-input-group" class="delayed-entry flex flex-col items-center gap-6 w-full">
            <div class="speech-bubble text-center font-bold">
                Abay apna naam to likh day!
            </div>
            <input type="text" id="player-name-input" placeholder="Yahan naam likho..." class="w-full bg-white border-4 border-black p-3 text-center focus:outline-none text-2xl font-bold">
            <p id="name-error" class="text-red-600 hidden font-black uppercase">Oye! Pehlay naam likh!</p>
            <button onclick="submitName()" class="funny-button-pink px-8 py-4 rounded-none text-xl">SHURU KARO!</button>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="screen-menu" class="screen comic-panel">
        <h2 id="welcome-text" class="text-3xl text-center font-black uppercase italic"></h2>
        <div class="text-center bg-white border-4 border-black p-4 rotate-1">
            <p class="font-bold uppercase text-xs">Aukaat (High Score)</p>
            <div class="flex items-center justify-center">
                <p id="high-score-display" class="text-5xl font-black text-blue-700">0</p>
                <button onclick="shareScore()" class="share-button active-elevate-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                    SHARE
                </button>
            </div>
        </div>
        <button onclick="startGame()" class="funny-button-cyan px-10 py-5 rounded-none text-3xl">HIMMAT HAI?</button>
    </div>

    <!-- Game Screen -->
    <div id="screen-game" class="screen comic-panel">
        <div class="flex justify-between w-full font-black text-sm uppercase">
            <div class="bg-white border-2 border-black px-2">SCORE: <span id="game-score" class="text-red-600">0</span></div>
            <div class="bg-white border-2 border-black px-2">LEVEL: <span id="game-level" class="text-blue-600">1</span></div>
        </div>
        <div id="timer-bar-container">
            <div id="timer-bar"></div>
        </div>
        <div id="question-text" class="text-4xl text-center font-black my-8 min-h-[120px] flex items-center justify-center bg-white border-4 border-black p-4 rotate-1"></div>
        <div class="flex gap-4 w-full">
            <button onclick="checkAnswer(true)" class="funny-button-cyan flex-1 py-5 text-2xl">SAHI</button>
            <button onclick="checkAnswer(false)" class="funny-button-pink flex-1 py-5 text-2xl">GALAT</button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="screen-over" class="screen comic-panel">
        <h1 class="text-5xl comic-title" style="background: black;">HAAN BHAI!</h1>
        <div class="text-center bg-white border-4 border-black p-4 -rotate-2">
            <p class="text-sm font-bold text-red-600 mb-1">Is sawal ne le dooba:</p>
            <p id="failed-question" class="text-base font-black italic mb-4 border-b-2 border-black pb-2"></p>
            <p class="text-2xl font-black">Score: <span id="final-score" class="text-blue-700">0</span></p>
            <p id="record-text" class="text-green-600 font-black hidden uppercase text-xl">NAYA RECORD! CHEETAY!</p>
        </div>
        <div class="speech-bubble text-center font-bold italic" id="insult-text"></div>
        <div class="flex flex-col gap-4 w-full">
            <button onclick="startGame()" class="funny-button-cyan py-4 text-xl w-full">DUBARA TRY KAR!</button>
            <div class="flex gap-4 w-full">
                <button onclick="showMenu()" class="funny-button-pink py-4 text-xl flex-[1.5]">MAIN DARR GAYA</button>
                <button onclick="shareScore()" class="funny-button-cyan py-4 text-xl flex-1 bg-green-500 text-white border-black">
                    <div class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                        SHARE
                    </div>
                </button>
            </div>
        </div>
    </div>

    <script>
        let playerName = "";
        let score = 0;
        let level = 1;
        let currentQuestion = null;
        let timerInterval = null;
        let timeLeft = 0;
        let maxTime = 5000;
        const minTime = 2000;
        let splashTimer = null;
        let inputLocked = false;
        
        let musicEnabled = true;
        let soundFXEnabled = true;

        const insults = [
            { text: "Beta, ludo khelo tum!", sound: "insult_1" },
            { text: "Bhai nashta kr ka nhi aaya kia?", sound: "insult_2" },
            { text: "Dimag pe zang to nhi laga?", sound: "insult_3" },
            { text: "Bhai badam khane ki zarurat hai!", sound: "insult_4" },
            { text: "Abay saans to lay lay pehlay!", sound: "insult_5" },
            { text: "Arey kehna kya chahtay ho?", sound: "insult_6" },
            { text: "Bhai badam nhi khate kia?", sound: "insult_7" },
            { text: "Choti bachi ho kya?", sound: "insult_8" }
        ];

        const praises = [
            { text: "Wah! Chaa Gaye Guru!", sound: "praise_1" },
            { text: "Heavy driver ho bhai!", sound: "praise_2" },
            { text: "Mauj kardi betay!", sound: "praise_3" },
            { text: "Ek dum jhakaas!", sound: "praise_4" },
            { text: "Paisa wasool performance!", sound: "praise_5" }
        ];

        const sounds = {};
        let currentBGM = null;

        function playSound(action) {
            if (!soundFXEnabled) return;
            if (!sounds[action]) {
                sounds[action] = new Audio(`assets/sounds/${action}.mp3`);
            }
            const audio = sounds[action];
            audio.currentTime = 0;
            audio.play().catch(e => console.error("Audio playback failed for:", action, e));
        }

        function playBGM(action, loop = true) {
            if (!musicEnabled) return;
            if (currentBGM && currentBGM.action === action) return;
            if (currentBGM) {
                currentBGM.audio.pause();
                currentBGM.audio.currentTime = 0;
            }
            if (!sounds[action]) {
                sounds[action] = new Audio(`assets/sounds/${action}.mp3`);
            }
            const audio = sounds[action];
            audio.loop = loop;
            audio.currentTime = 0;
            audio.volume = 0.3; 
            audio.play().catch(e => console.error("BGM playback failed for:", action, e));
            currentBGM = { audio, action };
        }

        function stopBGM() {
            if (currentBGM) {
                currentBGM.audio.pause();
                currentBGM.audio.currentTime = 0;
                currentBGM = null;
            }
        }

        window.onload = () => {
            playerName = localStorage.getItem('brainfry-playername');
        };

        function skipSplash() {
            const splash = document.getElementById('splash-screen');
            const nameInputGroup = document.getElementById('name-input-group');
            if (splash.classList.contains('hidden')) return;
            splash.classList.add('hidden');
            setTimeout(() => {
                if (playerName) {
                    showMenu();
                    playSound('menu_welcome');
                    playBGM('mainsound');
                } else {
                    nameInputGroup.classList.add('visible');
                    playSound('menu_welcome');
                    playBGM('mainsound');
                }
            }, 500);
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const homeBtn = document.getElementById('global-home-button');
            const settingsBtn = document.getElementById('global-settings-button');
            const infoBtn = document.getElementById('global-info-button');
            const logo = document.getElementById('game-logo-overlay');
            
            const isNameScreen = id === 'screen-name';
            homeBtn.classList.toggle('hidden', isNameScreen);
            settingsBtn.classList.toggle('hidden', isNameScreen);
            infoBtn.classList.toggle('hidden', isNameScreen);
            logo.classList.toggle('hidden', isNameScreen);

            if (id === 'screen-menu') {
                homeBtn.classList.add('hidden');
            }
            
            if (id === 'screen-menu' || id === 'screen-over') {
                playBGM('mainsound');
            }
            
            playSound('screen_transition');
        }

        // --- MODAL FUNCTIONS (Settings & Info) ---
        function toggleSettings(show) {
            const modal = document.getElementById('settings-modal');
            const overlay = document.getElementById('modal-overlay');
            if (show) {
                modal.classList.add('active');
                overlay.classList.add('active');
            } else {
                modal.classList.remove('active');
                if (!document.getElementById('info-modal').classList.contains('active')) {
                    overlay.classList.remove('active');
                }
            }
        }

        function toggleInfo(show) {
            const modal = document.getElementById('info-modal');
            const overlay = document.getElementById('modal-overlay');
            if (show) {
                modal.classList.add('active');
                overlay.classList.add('active');
            } else {
                modal.classList.remove('active');
                if (!document.getElementById('settings-modal').classList.contains('active')) {
                    overlay.classList.remove('active');
                }
            }
        }

        function closeAllModals() {
            toggleSettings(false);
            toggleInfo(false);
        }

        // --- SETTINGS FUNCTIONS ---
        function toggleMusic() {
            musicEnabled = !musicEnabled;
            document.getElementById('music-toggle-btn').innerText = `MUSIC: ${musicEnabled ? 'ON' : 'OFF'}`;
            if (musicEnabled) {
                const gameIsActive = document.getElementById('screen-game').classList.contains('active');
                if (!gameIsActive) playBGM('mainsound');
            } else {
                stopBGM();
            }
        }

        function toggleSoundFX() {
            soundFXEnabled = !soundFXEnabled;
            document.getElementById('soundfx-toggle-btn').innerText = `SOUNDS: ${soundFXEnabled ? 'ON' : 'OFF'}`;
            if (soundFXEnabled) playSound('button_click_start');
        }

        function resetHighScore() {
            if (confirm("High Score uda doun bhai?")) {
                localStorage.setItem('brainfry-highscore', 0);
                document.getElementById('high-score-display').innerText = 0;
                alert("High Score saaf ho gaya!");
            }
        }

        function resetName() {
            if (confirm("Naam change karna hai?")) {
                localStorage.removeItem('brainfry-playername');
                playerName = "";
                closeAllModals();
                document.getElementById('name-input-group').classList.remove('visible');
                showScreen('screen-name');
                setTimeout(() => document.getElementById('name-input-group').classList.add('visible'), 100);
            }
        }

        function shareScore() {
            const highScore = localStorage.getItem('brainfry-highscore') || 0;
            const text = `Bhai mere Brain-Fry me ${highScore} score hain! Himmat hai to thora muqabla kar lo: ${window.location.href}`;
            if (navigator.share && /Android|iPhone|iPad/i.test(navigator.userAgent)) {
                navigator.share({ title: 'Brain-Fry Challenge', text: text, url: window.location.href }).catch(console.error);
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert("Challenge clipboard me copy ho gaya hai! Ab ye apne dost ko bhejo!");
                }).catch(err => alert("Copy failed! Manual copy kar lo bhai."));
            }
        }

        function submitName() {
            const input = document.getElementById('player-name-input');
            const error = document.getElementById('name-error');
            if (input.value.trim() === "") {
                error.classList.remove('hidden');
                playSound('error_name_empty');
                return;
            }
            playerName = input.value.trim();
            localStorage.setItem('brainfry-playername', playerName);
            error.classList.add('hidden');
            playSound('button_click_start');
            showMenu();
        }

        function showMenu() {
            document.getElementById('welcome-text').innerText = `Oye, ${playerName}!`;
            const highScore = localStorage.getItem('brainfry-highscore') || 0;
            document.getElementById('high-score-display').innerText = highScore;
            showScreen('screen-menu');
        }

        function generateQuestion() {
            const isMath = score < 3 || Math.random() < 0.90;
            if (isMath) {
                let a, b, op, ans;
                if (level <= 2) { a = Math.floor(Math.random() * 10) + 1; b = Math.floor(Math.random() * 10) + 1; op = Math.random() > 0.5 ? '+' : '-'; }
                else if (level <= 5) { a = Math.floor(Math.random() * 20) + 1; b = Math.floor(Math.random() * 15) + 1; op = Math.random() > 0.5 ? '+' : '-'; }
                else { a = Math.floor(Math.random() * 12) + 1; b = Math.floor(Math.random() * 10) + 1; op = '*'; }
                if (op === '+') ans = a + b; else if (op === '-') ans = a - b; else ans = a * b;
                const offset = (Math.floor(Math.random() * 5) + 1) * (Math.random() > 0.5 ? 1 : -1);
                const displayAns = Math.random() > 0.5 ? ans : ans + offset;
                currentQuestion = { text: `${a} ${op === '*' ? 'x' : op} ${b} = ${displayAns}`, answer: displayAns === ans };
            } else {
                const facts = [{ t: "Fish can fly?", a: false }, { t: "Ice is hot?", a: false }, { t: "Sky is green?", a: false }, { t: "Fire is cold?", a: false }, { t: "Cats can bark?", a: false }, { t: "Water is dry?", a: false }, { t: "Sugar is sweet?", a: true }, { t: "Lemon is sour?", a: true }, { t: "Sun is cold?", a: false }, { t: "1 hour = 60m?", a: true }, { t: "Milk is white?", a: true }, { t: "Birds can swim?", a: false }, { t: "Grass is red?", a: false }, { t: "Dogs can fly?", a: false }, { t: "Apples are blue?", a: false }, { t: "Coal is black?", a: true }, { t: "Rocks are soft?", a: false }, { t: "Rain is wet?", a: true }, { t: "Spiders have 6 legs?", a: false }, { t: "Winter is hot?", a: false }, { t: "Elephants are tiny?", a: false }];
                const selected = facts[Math.floor(Math.random() * facts.length)];
                currentQuestion = { text: selected.t, answer: selected.a };
            }
            document.getElementById('question-text').innerText = currentQuestion.text;
        }

        function startGame() {
            score = 0; level = 1; maxTime = 5000;
            inputLocked = true; setTimeout(() => { inputLocked = false; }, 500);
            updateStats(); nextQuestion();
            playSound('game_start_countdown'); playBGM('playinggame');
            showScreen('screen-game');
        }

        function updateStats() {
            document.getElementById('game-score').innerText = score;
            document.getElementById('game-level').innerText = level;
        }

        function nextQuestion() {
            generateQuestion();
            timeLeft = maxTime;
            startTimer();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            const bar = document.getElementById('timer-bar');
            const start = Date.now();
            let tensionStarted = false;
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - start;
                const remaining = maxTime - elapsed;
                if (remaining <= 0) {
                    playSound('timer_timeout');
                    document.getElementById('failed-question').innerText = "Waqt khatam!";
                    gameOver();
                } else {
                    bar.style.width = ((remaining / maxTime) * 100) + "%";
                    if (remaining <= 2000 && maxTime <= 3000 && !tensionStarted) {
                        tensionStarted = true; playBGM('intension');
                    }
                }
            }, 50);
        }

        function checkAnswer(userAns) {
            if (!currentQuestion || inputLocked) return;
            if (userAns === currentQuestion.answer) {
                playSound('answer_correct'); score++;
                if (score % 5 === 0) { level++; playSound('level_up'); }
                maxTime = Math.max(minTime, maxTime - 150);
                updateStats(); nextQuestion();
            } else {
                document.getElementById('failed-question').innerText = currentQuestion.text;
                gameOver();
            }
        }

        function gameOver() {
            clearInterval(timerInterval);
            const gameScreen = document.getElementById('screen-game');
            gameScreen.classList.add('wobble-active');
            setTimeout(() => gameScreen.classList.remove('wobble-active'), 400);
            const highScore = localStorage.getItem('brainfry-highscore') || 0;
            const isNewRecord = score > highScore;
            setTimeout(() => {
                if (isNewRecord) {
                    localStorage.setItem('brainfry-highscore', score);
                    if (score > 5) {
                        document.getElementById('record-text').classList.remove('hidden');
                        const randomPraise = praises[Math.floor(Math.random() * praises.length)];
                        document.getElementById('insult-text').innerText = randomPraise.text;
                        playSound(randomPraise.sound);
                    }
                } else {
                    document.getElementById('record-text').classList.add('hidden');
                    const randomInsult = insults[Math.floor(Math.random() * insults.length)];
                    document.getElementById('insult-text').innerText = randomInsult.text;
                    playSound(randomInsult.sound);
                }
            }, 100);
            document.getElementById('final-score').innerText = score;
            showScreen('screen-over');
        }

        window.addEventListener('keydown', (e) => {
            const gameActive = document.getElementById('screen-game').classList.contains('active');
            if (gameActive && !inputLocked) {
                if (e.key === 'ArrowLeft') checkAnswer(true);
                if (e.key === 'ArrowRight') checkAnswer(false);
            }
        });
    </script>
</body>
</html>